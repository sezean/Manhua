<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZhenHua Reader - Style ManhuaDesu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0f1117; color: #e2e8f0; font-family: 'Segoe UI', sans-serif; }
        .manga-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; padding: 15px; }
        .manga-card { background: #1a1d26; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.3); transition: 0.3s; }
        .manga-card:hover { transform: translateY(-5px); }
        .thumb-container { position: relative; width: 100%; padding-top: 140%; }
        .thumb-container img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
        .manga-title { padding: 8px; font-size: 13px; font-weight: 600; line-height: 1.2; height: 40px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .chapter-list-item { background: #1a1d26; margin-bottom: 5px; padding: 12px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid #ed1c24; }
        .reader-img { width: 100%; display: block; background: #000; }
        .loader { border: 3px solid #333; border-top: 3px solid #ed1c24; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <header class="bg-[#1a1d26] p-4 sticky top-0 z-40 border-b border-gray-800">
        <div class="max-w-4xl mx-auto flex flex-col gap-3">
            <h1 class="text-xl font-black text-[#ed1c24] tracking-tighter uppercase">ZHENHUA <span class="text-white">DESU</span></h1>
            <div class="flex gap-2">
                <input id="searchInput" type="text" placeholder="Cari manhua favorit lo..." class="flex-1 bg-[#0f1117] border border-gray-700 p-2 rounded text-sm focus:outline-none focus:border-[#ed1c24]">
                <button onclick="searchManga()" class="bg-[#ed1c24] px-4 py-2 rounded font-bold text-sm hover:bg-red-700 transition">CARI</button>
            </div>
        </div>
    </header>

    <main id="mainContent" class="max-w-4xl mx-auto min-h-screen">
        <div id="contentDisplay" class="manga-grid">
            <p class="col-span-full text-center py-20 text-gray-500 italic">Ketik judul di atas untuk mencari...</p>
        </div>
    </main>

    <div id="viewer" class="hidden fixed inset-0 bg-black z-50 overflow-y-auto">
        <div class="bg-[#1a1d26]/90 p-3 sticky top-0 flex justify-between items-center z-[60]">
            <button onclick="closeViewer()" class="text-white bg-gray-800 px-3 py-1 rounded text-xs font-bold uppercase">Kembali</button>
            <span id="navTitle" class="text-xs font-semibold truncate px-4"></span>
            <div class="w-10"></div>
        </div>
        <div id="imageStream" class="flex flex-col items-center"></div>
    </div>

    <script>
        const PROXY = "https://api.allorigins.win/get?url=";
        const IMG_PROXY = "https://wsrv.nl/?url=";

        async function fetchAPI(url) {
            try {
                const res = await fetch(`${PROXY}${encodeURIComponent(url)}`);
                const data = await res.json();
                return JSON.parse(data.contents);
            } catch (e) {
                console.error("Fetch error:", e);
                return null;
            }
        }

        async function searchManga() {
            const q = document.getElementById('searchInput').value;
            const display = document.getElementById('contentDisplay');
            if(!q) return;
            
            display.innerHTML = '<div class="col-span-full py-20"><div class="loader"></div></div>';
            
            const api = `https://api.mangadex.org/manga?title=${encodeURIComponent(q)}&limit=20&contentRating[]=safe&contentRating[]=suggestive&contentRating[]=erotica&contentRating[]=pornographic&includes[]=cover_art`;
            const data = await fetchAPI(api);
            
            if(!data || !data.data.length) {
                display.innerHTML = '<p class="col-span-full text-center py-20 text-red-500">Judul tidak ditemukan!</p>';
                return;
            }

            display.innerHTML = "";
            data.data.forEach(m => {
                const title = m.attributes.title.en || m.attributes.title.ja || "No Title";
                const cover = m.relationships.find(r => r.type === 'cover_art');
                const fileName = cover ? cover.attributes.fileName : "";
                const thumb = fileName ? `https://uploads.mangadex.org/covers/${m.id}/${fileName}.256.jpg` : "https://via.placeholder.com/200x300?text=No+Cover";

                display.innerHTML += `
                    <div onclick="getChapters('${m.id}', '${title.replace(/'/g, "")}')" class="manga-card cursor-pointer">
                        <div class="thumb-container">
                            <img src="${IMG_PROXY}${encodeURIComponent(thumb)}" loading="lazy" alt="cover">
                        </div>
                        <div class="manga-title">${title}</div>
                    </div>`;
            });
        }

        async function getChapters(id, title) {
            const display = document.getElementById('contentDisplay');
            display.innerHTML = '<div class="col-span-full py-20"><div class="loader"></div></div>';
            
            const api = `https://api.mangadex.org/manga/${id}/feed?translatedLanguage[]=en&limit=100&order[chapter]=desc&contentRating[]=safe&contentRating[]=suggestive&contentRating[]=erotica&contentRating[]=pornographic`;
            const data = await fetchAPI(api);
            
            display.innerHTML = `<div class="col-span-full p-2"><h2 class="text-lg font-bold text-[#ed1c24] mb-4">${title}</h2></div>`;
            
            if(!data || !data.data.length) {
                display.innerHTML += '<p class="col-span-full text-center">Chapter tidak tersedia dalam bahasa Inggris.</p>';
                return;
            }

            data.data.forEach(ch => {
                display.innerHTML += `
                    <div onclick="viewImages('${ch.id}', 'Ch.${ch.attributes.chapter}')" class="col-span-full chapter-list-item cursor-pointer hover:bg-gray-800 transition">
                        <span class="font-bold">Chapter ${ch.attributes.chapter || '0'}</span>
                        <span class="text-[10px] text-gray-400">READ ></span>
                    </div>`;
            });
        }

        async function viewImages(chId, fullTitle) {
            const stream = document.getElementById('imageStream');
            const viewer = document.getElementById('viewer');
            document.getElementById('navTitle').innerText = fullTitle;
            viewer.classList.remove('hidden');
            stream.innerHTML = '<div class="py-40 text-center"><div class="loader mb-2"></div><p class="text-xs text-gray-500 italic">Membuka chapter...</p></div>';

            const data = await fetchAPI(`https://api.mangadex.org/at-home/server/${chId}`);
            if(!data) {
                alert("Gagal koneksi ke server!");
                closeViewer();
                return;
            }

            const hash = data.chapter.hash;
            const imgs = data.chapter.data;
            stream.innerHTML = "";

            imgs.forEach(file => {
                const url = `https://uploads.mangadex.org/data/${hash}/${file}`;
                const img = document.createElement('img');
                img.className = "reader-img";
                img.src = `${IMG_PROXY}${encodeURIComponent(url)}`;
                img.loading = "lazy";
                
                img.onerror = () => {
                    img.src = `https://images1-focus-opensocial.googleusercontent.com/gadgets/proxy?container=focus&refresh=2592000&url=${encodeURIComponent(url)}`;
                };
                
                stream.appendChild(img);
            });
            viewer.scrollTo(0,0);
        }

        function closeViewer() { document.getElementById('viewer').classList.add('hidden'); }
    </script>
</body>
</html>
